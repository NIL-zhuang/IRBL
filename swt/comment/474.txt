Instances of this class support the layout of selectable tool bar items p The item children that may be added to instances of this class must be of type code ToolItem code p p Note that although this class is a subclass of code Composite code it does not make sense to add code Control code children to it or set a layout on it p p dl dt b Styles b dt dd FLAT WRAP RIGHT HORIZONTAL VERTICAL SHADOW OUT dd dt b Events b dt dd none dd dl p Note Only one of the styles HORIZONTAL and VERTICAL may be specified p p IMPORTANT This class is em not em intended to be subclassed p
From the Windows SDK for TB SETBUTTONSIZE If an application does not explicitly set the button size the size defaults to 24 by 22 pixels
Ensure that either of HORIZONTAL or VERTICAL is set NOTE HORIZONTAL and VERTICAL have the same values as H SCROLL and V SCROLL so it is necessary to first clear these bits to avoid scroll bars and then reset the bits using the original style supplied by the programmer NOTE The CCS VERT style cannot be applied when the widget is created because of this conflict
Constructs a new instance of this class given its parent and a style value describing its behavior and appearance p The style value is either one of the style constants defined in class code SWT code which is applicable to instances of this class or must be built by em bitwise OR em ing together that is using the code int code operator two or more of those code SWT code style constants The class description lists the style constants that are applicable to the class Style bits are also inherited from superclasses p param parent a composite control which will be the parent of the new instance cannot be null param style the style of control to construct exception IllegalArgumentException ul li ERROR NULL ARGUMENT if the parent is null li ul exception SWTException ul li ERROR THREAD INVALID ACCESS if not called from the thread that created the parent li li ERROR INVALID SUBCLASS if this class is not an allowed subclass li ul see SWT FLAT see SWT WRAP see SWT RIGHT see SWT HORIZONTAL see SWT SHADOW OUT see SWT VERTICAL see Widget checkSubclass see Widget getStyle
Bug in Windows For some reason during the processing of WM SYSCHAR the tool bar window proc does not call the default window proc causing mnemonics for the menu bar to be ignored The fix is to always call the default window proc for WM SYSCHAR
On Windows only flat tool bars can be traversed
A vertical tool bar cannot wrap because TB SETROWS fails when the toobar has TBSTYLE WRAPABLE
Even though it is legal to create this widget with scroll bars they serve no useful purpose because they do not automatically scroll the widget s client area The fix is to clear the SWT style
From the Windows SDK for TB SETBUTTONSIZE If an application does not explicitly set the button size the size defaults to 24 by 22 pixels
Feature in Windows When TBSTYLE FLAT is used to create a flat toolbar for some reason TBSTYLE TRANSPARENT is also set This causes the toolbar to flicker when it is moved or resized The fix is to clear TBSTYLE TRANSPARENT NOTE This work around is unnecessary on XP There is no flickering and clearing the TBSTYLE TRANSPARENT interferes with the XP theme
Feature in Windows When the control is created it does not use the default system font A new HFONT is created and destroyed when the control is destroyed This means that a program that queries the font from this control uses the font in another control and then destroys this control will have the font unexpectedly destroyed in the other control The fix is to assign the font ourselves each time the control is created The control will not destroy a font that it did not create
Set the button struct bitmap and button sizes
Set the extended style bits
Bug in Windows Despite the fact that the image list index has never been set for the item Windows always assumes that the image index for the item is valid When an item is inserted the image index is zero Therefore when the first image is inserted and is assigned image index zero every item draws with this image The fix is to set the image index to none when the item is created This is not necessary in the case when the item has the BTNS SEP style because separators cannot show images
Feature in Windows For some reason a tool item that has the style BTNS SEP does not return I IMAGENONE when queried for an image index despite the fact that no attempt has been made to assign an image to the item As a result operations on an image list that use the wrong index cause random results The fix is to ensure that the tool item is not a separator before using the image index Since separators cannot have an image and one is never assigned this is not a problem
Bug in Windows When a tool item with the style BTNS CHECK or BTNS CHECKGROUP is selected and then disabled the item does not draw using the disabled image The fix is to use the disabled image in all image lists
Returns the item at the given zero relative index in the receiver Throws an exception if the index is out of range param index the index of the item to return return the item at the given index exception IllegalArgumentException ul li ERROR INVALID RANGE if the index is not between 0 and the number of elements in the list minus 1 inclusive li ul exception SWTException ul li ERROR WIDGET DISPOSED if the receiver has been disposed li li ERROR THREAD INVALID ACCESS if not called from the thread that created the receiver li ul
Returns the item at the given point in the receiver or null if no such item exists The point is in the coordinate system of the receiver param point the point used to locate the item return the item at the given point exception IllegalArgumentException ul li ERROR NULL ARGUMENT if the point is null li ul exception SWTException ul li ERROR WIDGET DISPOSED if the receiver has been disposed li li ERROR THREAD INVALID ACCESS if not called from the thread that created the receiver li ul
Returns the number of items contained in the receiver return the number of items exception SWTException ul li ERROR WIDGET DISPOSED if the receiver has been disposed li li ERROR THREAD INVALID ACCESS if not called from the thread that created the receiver li ul
Returns an array of code ToolItem code s which are the items in the receiver p Note This is not the actual structure used by the receiver to maintain its list of items so modifying the array will not affect the receiver p return the items in the receiver exception SWTException ul li ERROR WIDGET DISPOSED if the receiver has been disposed li li ERROR THREAD INVALID ACCESS if not called from the thread that created the receiver li ul
Returns the number of rows in the receiver When the receiver has the code WRAP code style the number of rows can be greater than one Otherwise the number of rows is always one return the number of items exception SWTException ul li ERROR WIDGET DISPOSED if the receiver has been disposed li li ERROR THREAD INVALID ACCESS if not called from the thread that created the receiver li ul
Searches the receiver s list starting at the first item index 0 until an item is found that is equal to the argument and returns the index of that item If no item is found returns 1 param item the search item return the index of the item exception IllegalArgumentException ul li ERROR NULL ARGUMENT if the tool item is null li li ERROR INVALID ARGUMENT if the tool item has been disposed li ul exception SWTException ul li ERROR WIDGET DISPOSED if the receiver has been disposed li li ERROR THREAD INVALID ACCESS if not called from the thread that created the receiver li ul
When the tool bar is vertical make the width of each button be the width of the widest button in the tool bar Note that when the tool bar contains a drop down item it needs to take into account extra padding
Feature in Windows TB MAPACCELERATOR matches either the mnemonic character or the first character in a tool item This behavior is undocumented and unwanted The fix is to ensure that the tool item contains a mnemonic when TB MAPACCELERATOR returns true
Feature in Windows When TBSTYLE TRANSPARENT is set in a tool bar that is drawing a background image in the image list that include transparency information do not draw correctly The fix is to clear and set TBSTYLE TRANSPARENT depending on the background color NOTE This work around is unnecessary on XP The TBSTYLE TRANSPARENT style is never cleared on that platform
Feature in Windows For some reason when a tool bar is repositioned more than once using DeferWindowPos into the same HDWP the toolbar redraws more than once defeating the puropse of DeferWindowPos The fix is to end the defered positioning before the next tool bar is added ensuring that only one tool bar position is deferred at any given time
Bug in Windows When WM SETFONT is sent to a tool bar that contains only separators causes the bitmap and button sizes to be set The fix is to reset these sizes after the font has been changed when the tool bar contains only separators
Feature in Windows When the TB SETROWS is used to set the number of rows in a tool bar the tool bar is resized to show the items This is unexpected The fix is to save and restore the current size of the tool bar
Feature in Windows When the last button in a tool bar has the style BTNS SEP and TB SETROWS is used to set the number of rows in the tool bar depending on the number of buttons the toolbar will wrap items with the style BTNS CHECK even when the fLarger flags is used to force the number of rows to be larger than the number of items The fix is to set the number of rows to be two larger than the actual number of rows in the tool bar When items are being added as long as the number of rows is at least one item larger than the count the tool bar is laid out properly When items are being removed setting the number of rows to be one more than the item count has no effect The number of rows is already one more causing TB SETROWS to do nothing Therefore choosing two instead of one as the row increment fixes both cases
NON NLS 1
NON NLS 1
Bug in Windows When the tool bar loses capture while an item is pressed in WM LBUTTONDOWN the item remains pressed The fix is unpress the item using TB SETSTATE
Feature in Windows When the toolbar window proc processes WM COMMAND it forwards this message to its parent This is done so that children of this control that send this message type to their parent will notify not only this control but also the parent of this control which is typically the application window and the window that is looking for the message If the control did not forward the message applications would have to subclass the control window to see the message Because the control window is subclassed by SWT the message is delivered twice once by SWT and once when the message is forwarded by the window proc The fix is to avoid calling the window proc for this control
Return DLGC BUTTON so that mnemonics will be processed without needing to press the ALT key when the widget has focus
Ensure that the window proc does not process VK SPACE so that it can be handled in WM CHAR This allows the application the opportunity to cancel the operation
Feature in Windows When the toolbar window proc processes WM NOTIFY it forwards this message to its parent This is done so that children of this control that send this message type to their parent will notify not only this control but also the parent of this control which is typically the application window and the window that is looking for the message If the control did not forward the message applications would have to subclass the control window to see the message Because the control window is subclassed by SWT the message is delivered twice once by SWT and once when the message is forwarded by the window proc The fix is to avoid calling the window proc for this control
Bug in Windows The code in Windows that determines when tool items should wrap seems to use the window bounds rather than the client area Unfortunately tool bars with the style TBSTYLE EX HIDECLIPPEDBUTTONS use the client area This means that buttons which overlap the border are hidden before they are wrapped The fix is to compute TBSTYLE EX HIDECLIPPEDBUTTONS and set it each time the tool bar is resized
Bug in Windows When a flat tool bar is wrapped Windows draws a horizontal separator between the rows The tool bar does not draw the first or the last two pixels of this separator When the toolbar is resized to be bigger only the new area is drawn and the last two pixels which are blank are drawn over by separator This leaves garbage on the screen The fix is to damage the pixels
